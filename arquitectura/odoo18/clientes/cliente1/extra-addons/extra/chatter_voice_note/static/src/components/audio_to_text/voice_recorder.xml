<templates id="template" xml:space="preserve">
    <t t-name="chatter_voice_note.VoiceRecorder" owl="1">
        <div class="o_container p-4">

            <!-- PANEL DE CONTROL PRINCIPAL -->
            <div class="card mb-4">
                <div class="card-header" t-att-class="state.operational_mode === 'bus' ? 'bg-success text-white' : 'bg-primary text-white'">
                    <h5 class="card-title mb-0">
                        <i class="fa fa-satellite-dish me-2"></i>
                        Sistema de Comunicaci√≥n H√≠brido
                    </h5>
                </div>
                <div class="card-body">
                    <!-- ESTADO DEL SISTEMA -->
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Modo Operativo:</strong>
                            <span t-if="state.operational_mode === 'bus'" class="badge bg-success ms-2">BUS ACTIVO</span>
                            <span t-else="" class="badge bg-primary ms-2">POLLING ACTIVO</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Bus Disponible:</strong>
                            <span t-if="state.bus_available" class="badge bg-success ms-2">‚úÖ</span>
                            <span t-else="" class="badge bg-danger ms-2">‚ùå</span>
                        </div>
                    </div>

                    <!-- M√âTRICAS -->
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <small>Tests Totales: <strong t-esc="state.total_tests"/></small>
                        </div>
                        <div class="col-md-4">
                            <small>√âxito Bus: <strong t-esc="state.bus_success_rate"/>%</small>
                        </div>
                        <div class="col-md-4">
                            <small>Eventos Bus: <strong t-esc="state.bus_events_received"/></small>
                        </div>
                    </div>

                    <!-- DEBUG -->
                    <div class="alert" t-att-class="state.last_method_used === 'bus' ? 'alert-success' : 'alert-info'">
                        <strong>Estado:</strong> <span t-esc="state.debug_info"/><br/>
                        <small>√öltimo m√©todo: <span t-esc="state.last_method_used"/></small>
                    </div>
                </div>
            </div>

            <!-- BOTONES DE CONTROL -->
            <div class="text-center mb-4">
                <button class="btn btn-success btn-lg me-2" t-on-click="testCommunication" t-att-disabled="state.loading_response">
                    <t t-if="state.loading_response">
                        <i class="fa fa-spinner fa-spin"></i> 
                        Procesando (<t t-esc="state.operational_mode"/>)
                    </t>
                    <t t-else="">
                        üöÄ Test Comunicaci√≥n Inteligente
                    </t>
                </button>
                
                <button class="btn btn-outline-warning btn-sm" t-on-click="testBusForced" t-att-disabled="state.loading_response">
                    üß™ Forzar Test Bus
                </button>
            </div>

            <!-- RESULTADOS -->
            <div class="row">
                <div class="col-md-6 mb-3">
                    <div class="card h-100">
                        <div class="card-header" t-att-class="state.final_message ? 'bg-success text-white' : 'bg-secondary text-white'">
                            <h6 class="card-title mb-0">
                                <i class="fa fa-message me-2"></i>
                                Mensaje Final
                                <t t-if="state.final_message">
                                    <span class="badge bg-light text-success ms-2">‚úì</span>
                                </t>
                            </h6>
                        </div>
                        <div class="card-body">
                            <p class="card-text" t-esc="state.final_message || 'Esperando mensaje...'"/>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <div class="card h-100">
                        <div class="card-header" t-att-class="state.answer_ia ? 'bg-success text-white' : 'bg-secondary text-white'">
                            <h6 class="card-title mb-0">
                                <i class="fa fa-robot me-2"></i>
                                Respuesta IA
                                <t t-if="state.answer_ia">
                                    <span class="badge bg-light text-success ms-2">‚úì</span>
                                </t>
                            </h6>
                        </div>
                        <div class="card-body">
                            <p class="card-text" t-esc="state.answer_ia || 'Esperando respuesta...'"/>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </t>
</templates>