<templates id="template" xml:space="preserve">
    <t t-name="chatter_voice_note.VoiceRecorder" owl="1">
        <div class="o_container p-4">
            <h2>üéôÔ∏è Voice Recorder</h2>
            <button t-on-click="toggleRecording"
                    t-att-class="'btn btn-lg ' + (state.recording ? 'btn-warning' : 'btn-primary')">
                <i t-att-class="'fa ' + (state.recording ? 'fa-stop' : 'fa-microphone')"></i>
                <t t-esc="state.recording ? ' Stop Recording' : ' Start Recording'"/>
            </button>

            <!-- Campo de b√∫squeda de contactos -->
            <div class="mt-3">
                <h4>Seleccionar contactos:</h4>
                <input t-model="state.searchTerm"
                       t-on-input="searchContacts"
                       type="text"
                       class="form-control"
                       placeholder="Buscar contactos por nombre..."
                       t-att-value="state.searchTerm"/>
                <div t-if="state.availableContacts.length > 0" class="mt-2">
                    <ul class="list-group">
                        <t t-foreach="state.availableContacts" t-as="contact" t-key="contact.id">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span t-esc="contact.name"/>
                                <button t-on-click="() => addContact(contact)"
                                        class="btn btn-sm btn-primary">
                                    Agregar
                                </button>
                            </li>
                        </t>
                    </ul>
                </div>
            </div>

            <!-- Lista de contactos seleccionados -->
            <div t-if="state.selectedContacts.length > 0" class="mt-3">
                <h4>Contactos seleccionados:</h4>
                <ul class="list-group">
                    <t t-foreach="state.selectedContacts" t-as="contact" t-key="contact.id">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span t-esc="contact.name"/>
                            <button t-on-click="() => removeContact(contact.id)"
                                    class="btn btn-sm btn-danger">
                                Quitar
                            </button>
                        </li>
                    </t>
                </ul>
            </div>

            <button t-on-click="sendToN8N"
                        t-att-disabled="state.isSending || state.recording || state.notes.length === 0"
                        class="btn btn-lg btn-success">
                    <span t-if="state.isSending" class="spinner-border spinner-border-sm me-2"/>
                    <t t-esc="state.isSending ? 'Enviando...' : 'Enviar a n8n'"/>
                </button>

            <div t-if="state.error" class="mt-2 text-danger">
                <t t-esc="state.error"/>
            </div>

            <div class="mt-3">
                <h4>Notas grabadas:</h4>
                <t t-foreach="this.sortedNotes" t-as="note" t-key="note.id">
                    <div class="mb-2 p-2 border rounded d-flex align-items-center justify-content-between">
                        <div class="flex-grow-1 me-3">
                            <strong t-esc="note.name"/>
                            <audio t-att-src="note.url" t-att-controls="true" class="d-block mt-1"></audio>
                            <div t-if="note.uploading" class="text-info">Subiendo...</div>
                            <div t-if="note.error" class="text-danger" t-esc="note.error"></div>
                        </div>

                        <button t-on-click="() => this.deleteNote(note.id)"
                                class="btn btn-sm btn-danger ms-2"
                                aria-label="Eliminar nota">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </t>
            </div>
         </div>
    </t>
</templates>
